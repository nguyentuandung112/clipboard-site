<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qu·∫£n l√Ω t√†i kho·∫£n & Clipboard (Realtime)</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 30px auto; background: #f4f9ff; padding: 20px; border-radius: 12px; }
    h2 { border-bottom: 2px solid #ccc; padding-bottom: 5px; margin-top: 30px; }
    .stat, .controls { margin: 10px 0; font-weight: bold; }
    .stats-bar { display: flex; justify-content: space-between; margin: 10px 0; }
    .field, .account-box { margin: 8px 0; background: #fff; padding: 10px; border-radius: 6px; }
    .field { display: flex; justify-content: space-between; align-items: center; background: #eef2f7; }
    textarea { width: 100%; font-family: monospace; padding: 10px; margin-top: 10px; }
    button { margin: 6px 5px 10px 0; padding: 6px 12px; cursor: pointer; }
    .delete-btn { background: red; color: white; border: none; border-radius: 6px; }
    input[type="file"] { margin: 8px 0; }
  </style>
</head>
<body>
  <h2>T√°c v·ª• 1: D√°n n·ªôi dung t·ª´ clipboard</h2>
  <div class="stat">S·ªë d√≤ng ƒë√£ d√°n: <span id="clipboardCount">0</span></div>
  <button onclick="pasteNote()">üìã D√°n</button>
  <button onclick="exportNotes()">üìÑ Xu·∫•t .txt</button>
  <ul id="noteList"></ul>

  <h2>T√°c v·ª• 2: Qu·∫£n l√Ω t√†i kho·∫£n</h2>
  <div class="stats-bar">
    <span>Ch∆∞a d√πng: <span id="accountTotal">0</span></span>
    <span>ƒê√£ d√πng: <span id="accountCopied">0</span></span>
  </div>
  <div class="controls">
    <button onclick="filterAccounts(false)">Hi·ªán t√†i kho·∫£n ch∆∞a d√πng</button>
    <button onclick="filterAccounts(true)">Hi·ªán t√†i kho·∫£n ƒë√£ d√πng</button>
  </div>
  <input type="file" id="txtUpload" accept=".txt">
  
  <button onclick="exportAccounts()">üìÑ Xu·∫•t .txt</button>
  <div id="accountList"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA7abH9ttrzdGHEs3UoRKnrNKamO-s8K9Q",
      authDomain: "hoangcoka123-7bb54.firebaseapp.com",
      databaseURL: "https://hoangcoka123-7bb54-default-rtdb.firebaseio.com",
      projectId: "hoangcoka123-7bb54",
      storageBucket: "hoangcoka123-7bb54.appspot.com",
      messagingSenderId: "615010120621",
      appId: "1:615010120621:web:3c55dcbf857d4e826f2724"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const accounts = {}; let filterCopied = null;

    function pasteNote() {
      navigator.clipboard.readText().then(text => {
        if (!text) return;
        db.ref("clipboardNotes").push(text);
      });
    }
    function exportNotes() {
      db.ref("clipboardNotes").once("value", snap => {
        const content = Object.values(snap.val() || {}).join("\n");
        const blob = new Blob([content], { type: "text/plain" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "notes.txt"; a.click();
      });
    }
    db.ref("clipboardNotes").on("value", snap => {
      const data = snap.val() || {};
      document.getElementById("clipboardCount").textContent = Object.keys(data).length;
      const list = document.getElementById("noteList");
      list.innerHTML = "";
      Object.values(data).forEach(text => {
        const li = document.createElement("li");
        li.textContent = text;
        list.appendChild(li);
      });
    });

    function updateStats() {
      const all = Object.values(accounts);
      document.getElementById("accountTotal").textContent = all.filter(a => !a.copied).length;
      document.getElementById("accountCopied").textContent = all.filter(a => a.copied).length;
    }
    function parseLine(line) {
      const parts = line.includes(":") ? line.split(":") : line.includes("|") ? line.split("|") : line.split(/\s+/);
      return parts;
    }
    function parseAccounts() {
      const lines = document.getElementById("accountInput").value.trim().split("\n");
      lines.forEach(line => {
        const p = parseLine(line);
        if (p.length >= 4) db.ref("accounts").push({
          username: p[0], password: p[1], email: p[2], emailPass: p[3], idApple: p[4]||"", idApplePass: p[5]||"", copied: false
        });
      });
    }
    document.getElementById("fileInput").addEventListener("change", function(e) {
      const f = e.target.files[0];
      if (!f) return;
      const r = new FileReader();
      r.onload = e => {
        try {
          const data = JSON.parse(e.target.result);
          data.forEach(acc => {
            if (acc.username && acc.password && acc.email && acc.emailPass) {
              db.ref("accounts").push({ ...acc, idApple: acc.idApple || "", idApplePass: acc.idApplePass || "", copied: false });
            }
          });
        } catch (err) { alert("File kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng JSON!"); }
      };
      r.readAsText(f);
    });
    document.getElementById("txtUpload").addEventListener("change", function(e) {
      const f = e.target.files[0];
      if (!f) return;
      const r = new FileReader();
      r.onload = e => {
        const lines = e.target.result.trim().split("\n");
        lines.forEach(line => {
          const p = parseLine(line);
          if (p.length >= 4) db.ref("accounts").push({
            username: p[0], password: p[1], email: p[2], emailPass: p[3], idApple: p[4]||"", idApplePass: p[5]||"", copied: false
          });
        });
        alert("‚úÖ ƒê√£ nh·∫≠p t·ª´ TXT th√†nh c√¥ng!");
      };
      r.readAsText(f);
    });
    db.ref("accounts").on("value", snap => {
      const data = snap.val() || {};
      Object.keys(accounts).forEach(k => delete accounts[k]);
      Object.assign(accounts, data);
      updateStats(); renderAccounts();
    });
    function renderAccounts() {
      const list = document.getElementById("accountList");
      list.innerHTML = "";
      Object.entries(accounts).forEach(([id, acc]) => {
        if (filterCopied !== null && acc.copied !== filterCopied) return;
        const box = document.createElement("div");
        box.className = "account-box";
        [
          { label: "T√™n ƒëƒÉng nh·∫≠p", value: acc.username },
          { label: "M·∫≠t kh·∫©u", value: acc.password },
          { label: "Email", value: acc.email },
          { label: "M·∫≠t kh·∫©u Email", value: acc.emailPass },
          { label: "ID Apple", value: acc.idApple },
          { label: "M·∫≠t kh·∫©u ID Apple", value: acc.idApplePass }
        ].forEach(field => {
          const row = document.createElement("div");
          row.className = "field";
          const label = document.createElement("span");
          label.textContent = field.label;
          const valueSpan = document.createElement("span");
          valueSpan.textContent = field.value;
          const btn = document.createElement("button");
          btn.textContent = "Copy";
          btn.onclick = () => {
            navigator.clipboard.writeText(field.value);
            db.ref(`accounts/${id}/copied`).set(true);
          };
          row.append(label, valueSpan, btn);
          box.appendChild(row);
        });
        const delBtn = document.createElement("button");
        delBtn.className = "delete-btn";
        delBtn.textContent = "Xo√° t√†i kho·∫£n";
        delBtn.onclick = () => db.ref(`accounts/${id}`).remove();
        box.appendChild(delBtn);
        list.appendChild(box);
      });
    }
    function filterAccounts(val) {
      filterCopied = val;
      renderAccounts();
    }
    function copyAllAccounts() {
      const c = Object.values(accounts).map(acc => `${acc.username}:${acc.password}:${acc.email}:${acc.emailPass}:${acc.idApple}:${acc.idApplePass}`).join("\n");
      navigator.clipboard.writeText(c).then(() => alert("ƒê√£ copy t·∫•t c·∫£!"));
    }
    function exportAccounts() {
      const c = Object.values(accounts).map(acc => `${acc.username}:${acc.password}:${acc.email}:${acc.emailPass}:${acc.idApple}:${acc.idApplePass}`).join("\n");
      const blob = new Blob([c], { type: "text/plain" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "accounts.txt";
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
